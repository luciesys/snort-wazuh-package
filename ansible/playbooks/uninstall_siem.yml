---
- name: "ğŸ—‘ï¸ DÃ©sinstallation SIEM"
  hosts: siem_servers
  become: yes

  tasks:
    - name: "âš ï¸ DÃ©sinstallation en cours"
      debug:
        msg: "Suppression SIEM sur {{ inventory_hostname }}"

    - name: "ğŸ›‘ ArrÃªter services"
      systemd:
        name: "{{ item }}"
        state: stopped
      loop:
        - snort
        - wazuh-manager
        - wazuh-indexer
        - wazuh-dashboard
        - filebeat
      ignore_errors: yes

    - name: "ğŸ—‘ï¸ Supprimer paquets"
      apt:
        name:
          - snort
          - wazuh-manager
          - wazuh-indexer
          - wazuh-dashboard
          - filebeat
        state: absent
        purge: yes
      ignore_errors: yes

    - name: "ğŸ—‘ï¸ Supprimer rÃ©pertoires"
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - /var/ossec
        - /etc/wazuh-indexer
        - /var/lib/wazuh-indexer
        - /etc/snort
        - /var/log/snort

    - name: "ğŸ§¹ Nettoyer APT"
      apt:
        autoremove: yes
        autoclean: yes

    - name: "âœ… TerminÃ©"
      debug:
        msg: "SIEM supprimÃ© de {{ inventory_hostname }}"
